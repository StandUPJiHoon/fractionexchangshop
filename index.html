<!doctype html>
<html lang="ko">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¶„ìˆ˜ êµí™˜ ìƒì </title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
    }

    html, body {
      height: 100%;
    }

    .app-wrapper {
      width: 100%;
      height: 100%;
      overflow-auto;
      padding: 32px 24px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 32px;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .header h1 {
      font-size: 48px;
      margin: 0;
      color: #4a5568;
      font-weight: 700;
    }

    .header p {
      font-size: 18px;
      color: #718096;
      margin: 8px 0;
      line-height: 1.6;
    }

    .header-toggle-btn {
      padding: 10px 20px;
      background: #f59e0b;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .header-toggle-btn:hover {
      background: #d97706;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
    }

    .header-toggle-btn.active {
      background: #48bb78;
    }

    .header-toggle-btn.active:hover {
      background: #38a169;
      box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
    }

    .shops-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 32px;
      transition: all 0.3s ease;
    }

    .shops-container.hidden {
      display: none;
    }

    .shop-section {
      background: #f7fafc;
      border-radius: 16px;
      padding: 24px;
      border: 3px solid;
    }

    .shop-section.shop1 {
      border-color: #48bb78;
    }

    .shop-section.shop2 {
      border-color: #f59e0b;
    }

    .shop-title {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin: 0 0 16px 0;
    }

    .shop-section.shop1 .shop-title {
      color: #48bb78;
    }

    .shop-section.shop2 .shop-title {
      color: #f59e0b;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 32px;
      transition: all 0.3s ease;
    }

    .main-content.hidden {
      display: none;
    }

    .section {
      background: #f7fafc;
      border-radius: 16px;
      padding: 24px;
      border: 2px solid #e2e8f0;
    }

    .section-title {
      font-size: 22px;
      font-weight: 600;
      color: #2d3748;
      margin: 0 0 16px 0;
      text-align: center;
    }

    .problem-display {
      background: white;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      margin-bottom: 20px;
      border: 3px solid #805ad5;
    }

    .problem-text {
      font-size: 32px;
      font-weight: 700;
      color: #553c9a;
      margin: 0;
    }

    .fraction {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      vertical-align: middle;
      margin: 0 4px;
    }

    .fraction-numerator {
      border-bottom: 2px solid currentColor;
      padding: 0 8px 2px 8px;
      line-height: 1;
    }

    .fraction-denominator {
      padding: 2px 8px 0 8px;
      line-height: 1;
    }

    .mixed-number {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .draggable-card {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: move;
      border: 3px solid transparent;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .draggable-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
      border-color: #f5576c;
    }

    .draggable-card.dragging {
      opacity: 0.5;
    }

    .fraction-display {
      font-size: 36px;
      font-weight: 700;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .drag-hint {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      margin-top: 8px;
    }

    .new-problem-btn {
      width: 100%;
      padding: 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .new-problem-btn:hover {
      background: #5568d3;
    }

    .visualization-area {
      min-height: 250px;
      max-height: 400px;
      overflow-y: auto;
    }

    .vis-content {
      text-align: center;
    }

    .vis-label {
      font-size: 16px;
      color: #4a5568;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .bars-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 16px 0;
    }

    .bar-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .bar {
      height: 32px;
      background: #48bb78;
      border-radius: 6px;
      border: 2px solid #2f855a;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }

    .whole-bar {
      width: 80px;
    }

    .fraction-bar {
      background: #ed8936;
      border-color: #c05621;
    }

    .conversion-text {
      font-size: 24px;
      font-weight: 700;
      color: #805ad5;
      margin: 16px 0;
    }

    .conversion-steps {
      font-size: 16px;
      color: #718096;
      margin-top: 12px;
    }

    .drop-zone {
      border: 3px dashed;
      border-radius: 16px;
      padding: 32px 24px;
      text-align: center;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease;
    }

    .shop1 .drop-zone {
      background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
      border-color: #48bb78;
    }

    .shop2 .drop-zone {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      border-color: #f59e0b;
    }

    .drop-zone.drag-over {
      transform: scale(1.02);
    }

    .shop1 .drop-zone.drag-over {
      background: linear-gradient(135deg, #96e6a1 0%, #48bb78 100%);
    }

    .shop2 .drop-zone.drag-over {
      background: linear-gradient(135deg, #fdcb6e 0%, #fab1a0 100%);
    }

    .drop-zone-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .shop1 .drop-zone-title {
      color: #2f855a;
    }

    .shop2 .drop-zone-title {
      color: #d97706;
    }

    .drop-zone-desc {
      font-size: 14px;
      color: #636e72;
      line-height: 1.5;
    }

    .exchange-result {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 16px;
      border: 2px solid;
    }

    .shop1 .exchange-result {
      border-color: #48bb78;
    }

    .shop2 .exchange-result {
      border-color: #f59e0b;
    }

    .exchange-result-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .shop1 .exchange-result-title {
      color: #48bb78;
    }

    .shop2 .exchange-result-title {
      color: #f59e0b;
    }

    .exchange-result-text {
      font-size: 22px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .answer-section {
      background: #edf2f7;
      border-radius: 16px;
      padding: 32px;
      margin-top: 32px;
    }

    .answer-prompt {
      font-size: 20px;
      font-weight: 600;
      color: #2d3748;
      text-align: center;
      margin-bottom: 24px;
    }

    .answer-input-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .answer-input {
      width: 80px;
      height: 60px;
      font-size: 32px;
      text-align: center;
      border: 3px solid #cbd5e0;
      border-radius: 8px;
      font-weight: 600;
      color: #2d3748;
    }

    .answer-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .answer-fraction-input {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .answer-fraction-input input {
      width: 80px;
      height: 50px;
      font-size: 28px;
      text-align: center;
      border: 3px solid #cbd5e0;
      border-radius: 8px;
      font-weight: 600;
      color: #2d3748;
    }

    .answer-fraction-input input:focus {
      outline: none;
      border-color: #667eea;
    }

    .answer-fraction-line {
      width: 80px;
      height: 3px;
      background: #4a5568;
      border-radius: 2px;
    }

    .action-buttons {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .btn {
      padding: 14px 32px;
      font-size: 18px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #48bb78;
      color: white;
    }

    .btn-primary:hover {
      background: #38a169;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
    }

    .btn-secondary {
      background: #4299e1;
      color: white;
    }

    .btn-secondary:hover {
      background: #3182ce;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
    }

    .feedback {
      text-align: center;
      padding: 20px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      display: none;
    }

    .feedback.correct {
      background: #c6f6d5;
      color: #22543d;
      border: 2px solid #48bb78;
    }

    .feedback.incorrect {
      background: #fed7d7;
      color: #742a2a;
      border: 2px solid #f56565;
    }

    .solution-box {
      background: white;
      border-radius: 12px;
      padding: 24px;
      border: 2px solid #4299e1;
      display: none;
    }

    .solution-box.visible {
      display: block;
    }

    .solution-steps {
      font-size: 18px;
      color: #2d3748;
      line-height: 2;
    }

    .solution-step {
      margin: 8px 0;
      padding-left: 20px;
    }

    @media (max-width: 968px) {
      .shops-container {
        grid-template-columns: 1fr;
      }

      .main-content {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 24px;
      }

      .header h1 {
        font-size: 36px;
      }

      .header-top {
        flex-direction: column;
        gap: 12px;
      }

      .header-toggle-btn {
        font-size: 14px;
        padding: 8px 16px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-wrapper">
   <div class="container">
    <div class="header">
     <div class="header-top">
      <h1 id="app-title">ğŸª ë¶„ìˆ˜ êµí™˜ ìƒì </h1><button class="header-toggle-btn" id="toggle-shop-btn">ğŸ‘ï¸ ë¶„ìˆ˜ ìƒì  ìˆ¨ê¸°ê¸°</button>
     </div>
     <p id="description-1">ëŒ€ë¶„ìˆ˜ë¥¼ ë³€í™˜í•˜ì—¬, ë¶„ìˆ˜ë¼ë¦¬ ëº„ ìˆ˜ ì—†ëŠ” ëŒ€ë¶„ìˆ˜ ëº„ì…ˆì„ ì—°ìŠµí•´ìš”.</p>
     <p id="description-2">ëŒ€ë¶„ìˆ˜ë¥¼ ë¶„ìˆ˜ êµí™˜ ìƒì ì— ëŒì–´ ë†“ìœ¼ë©´, ë‹¤ë¥¸ ë¶„ìˆ˜ë¡œ ë³€í™˜ë˜ëŠ” ëª¨ìŠµì„ ë¹„êµí•  ìˆ˜ ìˆì–´ìš”.</p>
    </div>
    <div class="section" style="margin-bottom: 32px;">
     <h2 class="section-title">ë¬¸ì œ</h2>
     <div class="problem-display">
      <p class="problem-text" id="problem-text"><span class="mixed-number">2<span class="fraction"><span class="fraction-numerator">1</span><span class="fraction-denominator">4</span></span></span> âˆ’ <span class="mixed-number">1<span class="fraction"><span class="fraction-numerator">3</span><span class="fraction-denominator">4</span></span></span></p>
     </div>
     <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
      <div class="draggable-card" draggable="true" id="draggable-fraction-left">
       <div class="fraction-display" id="fraction-display-left">
        <span class="mixed-number">2<span class="fraction"><span class="fraction-numerator">1</span><span class="fraction-denominator">4</span></span></span>
       </div>
       <div class="drag-hint">
        ğŸ‘† ìƒì ì— ëŒì–´ ë†“ê¸°
       </div>
      </div>
      <div class="draggable-card" draggable="true" id="draggable-fraction-right">
       <div class="fraction-display" id="fraction-display-right">
        <span class="mixed-number">1<span class="fraction"><span class="fraction-numerator">3</span><span class="fraction-denominator">4</span></span></span>
       </div>
       <div class="drag-hint">
        ğŸ‘† ìƒì ì— ëŒì–´ ë†“ê¸°
       </div>
      </div>
     </div><button class="new-problem-btn" id="new-problem-btn">ğŸ”„ ìƒˆ ë¬¸ì œ ë§Œë“¤ê¸°</button>
    </div>
    <div class="shops-container" id="shops-container">
     <div class="shop-section shop1">
      <h2 class="shop-title" id="shop1-title">ğŸŸ¢ ìƒì  1</h2>
      <div class="drop-zone" id="drop-zone-1">
       <div class="drop-zone-title">
        ìì—°ìˆ˜ 1ë§Œ ë¶„ìˆ˜ë¡œ
       </div>
       <div class="drop-zone-desc">
        ìì—°ìˆ˜ 1ë§Œí¼ ë¶„ìˆ˜ë¡œ ë°”ê¿”ì„œ<br>
        ë¶„ìˆ˜ì— ë”í•´ì¤ë‹ˆë‹¤.
       </div>
       <div class="exchange-result" id="exchange-result-1" style="display: none;">
        <div class="exchange-result-title">
         âœ… êµí™˜ ì™„ë£Œ!
        </div>
        <div class="exchange-result-text" id="exchange-text-1"></div>
        <div class="conversion-steps" id="exchange-steps-1"></div>
       </div>
      </div>
     </div>
     <div class="shop-section shop2">
      <h2 class="shop-title" id="shop2-title">ğŸŸ¢ ìƒì  2</h2>
      <div class="drop-zone" id="drop-zone-2">
       <div class="drop-zone-title">
        ì™„ì „íˆ ê°€ë¶„ìˆ˜ë¡œ
       </div>
       <div class="drop-zone-desc">
        ëª¨ë“  ìì—°ìˆ˜ë¥¼ ë¶„ìˆ˜ë¡œ ë°”ê¿”ì„œ<br>
        ì™„ì „í•œ ê°€ë¶„ìˆ˜ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
       </div>
       <div class="exchange-result" id="exchange-result-2" style="display: none;">
        <div class="exchange-result-title">
         âœ… êµí™˜ ì™„ë£Œ!
        </div>
        <div class="exchange-result-text" id="exchange-text-2"></div>
        <div class="conversion-steps" id="exchange-steps-2"></div>
       </div>
      </div>
     </div>
    </div>
    <div class="main-content" id="main-content">
     <div class="section">
      <h2 class="section-title">ğŸŸ¢ ìƒì  1 ì´ë¯¸ì§€ í‘œí˜„</h2>
      <div class="visualization-area" id="visualization-area-1">
       <div class="vis-content">
        <div id="conversion-display-1" style="display: none;">
         <div class="vis-label">
          ë¶„ìˆ˜ë¥¼ ë§‰ëŒ€ë¡œ í‘œí˜„
         </div>
         <div class="bars-container" id="initial-bars-1"></div>
         <div class="conversion-text" id="conversion-text-1"></div>
         <div class="vis-label" style="margin-top: 24px;">
          êµí™˜ í›„ ë§‰ëŒ€ í‘œí˜„
         </div>
         <div class="bars-container" id="improper-bars-1"></div>
         <div class="conversion-steps" id="conversion-steps-1"></div>
        </div>
        <div id="no-exchange-message-1">
         <p style="color: #a0aec0; font-size: 16px; margin-top: 32px;">ìƒì  1ì— ì•„ì§ ë„£ì§€ ì•Šì•˜ì–´ìš”.</p>
        </div>
       </div>
      </div>
     </div>
     <div class="section">
      <h2 class="section-title">ğŸŸ¢ ìƒì  2 ì´ë¯¸ì§€ í‘œí˜„</h2>
      <div class="visualization-area" id="visualization-area-2">
       <div class="vis-content">
        <div id="conversion-display-2" style="display: none;">
         <div class="vis-label">
          ë¶„ìˆ˜ë¥¼ ë§‰ëŒ€ë¡œ í‘œí˜„
         </div>
         <div class="bars-container" id="initial-bars-2"></div>
         <div class="conversion-text" id="conversion-text-2"></div>
         <div class="vis-label" style="margin-top: 24px;">
          êµí™˜ í›„ ë§‰ëŒ€ í‘œí˜„
         </div>
         <div class="bars-container" id="improper-bars-2"></div>
         <div class="conversion-steps" id="conversion-steps-2"></div>
        </div>
        <div id="no-exchange-message-2">
         <p style="color: #a0aec0; font-size: 16px; margin-top: 32px;">ìƒì 2ì— ì•„ì§ ë„£ì§€ ì•Šì•˜ì–´ìš”.</p>
        </div>
       </div>
      </div>
     </div>
    </div>
    <div class="answer-section">
     <div class="answer-prompt">
      ì´ì œ ëŒ€ë¶„ìˆ˜ë¼ë¦¬ì˜ ëº„ì…ˆì„ ê³„ì‚°í•´ ë³´ê³ , ì •ë‹µì„ ëŒ€ë¶„ìˆ˜ë¡œ ì¨ ë³´ì„¸ìš”.
     </div>
     <div class="answer-input-container"><input type="number" class="answer-input" id="answer-whole" min="0" placeholder="0">
      <div class="answer-fraction-input"><input type="number" id="answer-numerator" min="0" placeholder="0">
       <div class="answer-fraction-line"></div><input type="number" id="answer-denominator" min="1" placeholder="4">
      </div>
     </div>
     <div class="action-buttons"><button class="btn btn-primary" id="check-answer-btn">âœ“ ì •ë‹µ í™•ì¸</button> <button class="btn btn-secondary" id="show-solution-btn">ğŸ“– í•´ì„¤ë³´ê¸°</button>
     </div>
     <div class="feedback" id="feedback"></div>
     <div class="solution-box" id="solution-box">
      <div class="solution-steps" id="solution-steps"></div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: "ğŸª ë¶„ìˆ˜ êµí™˜ ìƒì ",
      description_1: "ëŒ€ë¶„ìˆ˜ë¥¼ ë³€í™˜í•˜ì—¬, ë¶„ìˆ˜ë¼ë¦¬ ëº„ ìˆ˜ ì—†ëŠ” ëŒ€ë¶„ìˆ˜ ëº„ì…ˆì„ ì—°ìŠµí•´ìš”.",
      description_2: "ëŒ€ë¶„ìˆ˜ë¥¼ ë¶„ìˆ˜ êµí™˜ ìƒì ì— ëŒì–´ ë†“ìœ¼ë©´, ë‹¤ë¥¸ ë¶„ìˆ˜ë¡œ ë³€í™˜ë˜ëŠ” ëª¨ìŠµì„ ë¹„êµí•  ìˆ˜ ìˆì–´ìš”.",
      shop1_title: "ğŸŸ¢ ìƒì  1",
      shop2_title: "ğŸŸ¢ ìƒì  2",
      new_problem_button: "ğŸ”„ ìƒˆ ë¬¸ì œ ë§Œë“¤ê¸°",
      toggle_shop_button: "ğŸ‘ï¸ ë¶„ìˆ˜ ìƒì  ìˆ¨ê¸°ê¸°",
      check_answer_button: "âœ“ ì •ë‹µ í™•ì¸",
      show_solution_button: "ğŸ“– í•´ì„¤ë³´ê¸°",
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      background_color: "#f7fafc",
      text_color: "#2d3748",
      accent_color: "#48bb78"
    };

    let currentProblem = {
      leftWhole: 2,
      leftNum: 1,
      denom: 4,
      rightWhole: 1,
      rightNum: 3,
      answerWhole: 0,
      answerNum: 2,
      exchangedLeft1: false,
      exchangedLeft2: false,
      exchangedRight1: false,
      exchangedRight2: false
    };

    let shopsVisible = true;

    function generateProblem() {
      const denom = [3, 4, 5][Math.floor(Math.random() * 3)];
      let leftWhole, leftNum, rightWhole, rightNum;
      
      do {
        leftWhole = Math.floor(Math.random() * 4) + 2;
        rightWhole = Math.floor(Math.random() * (leftWhole - 1)) + 1;
        leftNum = Math.floor(Math.random() * (denom - 1)) + 1;
        rightNum = Math.floor(Math.random() * (denom - 1)) + 1;
        
        if (leftNum >= rightNum) {
          continue;
        }
        
        const leftImproper = leftWhole * denom + leftNum;
        const rightImproper = rightWhole * denom + rightNum;
        const result = leftImproper - rightImproper;
        
        if (result > 0) {
          const answerWhole = Math.floor(result / denom);
          const answerNum = result % denom;
          
          if (answerNum > 0) {
            currentProblem = {
              leftWhole,
              leftNum,
              denom,
              rightWhole,
              rightNum,
              answerWhole,
              answerNum,
              exchangedLeft1: false,
              exchangedLeft2: false,
              exchangedRight1: false,
              exchangedRight2: false
            };
            return;
          }
        }
      } while (true);
    }

    function updateProblemDisplay() {
      const { leftWhole, leftNum, denom, rightWhole, rightNum } = currentProblem;
      
      document.getElementById('problem-text').innerHTML = 
        `<span class="mixed-number">${leftWhole}<span class="fraction"><span class="fraction-numerator">${leftNum}</span><span class="fraction-denominator">${denom}</span></span></span> âˆ’ <span class="mixed-number">${rightWhole}<span class="fraction"><span class="fraction-numerator">${rightNum}</span><span class="fraction-denominator">${denom}</span></span></span>`;
      
      document.getElementById('fraction-display-left').innerHTML = 
        `<span class="mixed-number">${leftWhole}<span class="fraction"><span class="fraction-numerator">${leftNum}</span><span class="fraction-denominator">${denom}</span></span></span>`;
      
      document.getElementById('fraction-display-right').innerHTML = 
        `<span class="mixed-number">${rightWhole}<span class="fraction"><span class="fraction-numerator">${rightNum}</span><span class="fraction-denominator">${denom}</span></span></span>`;
      
      document.getElementById('exchange-result-1').style.display = 'none';
      document.getElementById('exchange-result-2').style.display = 'none';
      document.getElementById('conversion-display-1').style.display = 'none';
      document.getElementById('conversion-display-2').style.display = 'none';
      document.getElementById('no-exchange-message-1').style.display = 'block';
      document.getElementById('no-exchange-message-2').style.display = 'block';
      
      document.getElementById('feedback').style.display = 'none';
      document.getElementById('solution-box').style.display = 'none';
      
      document.getElementById('answer-whole').value = '';
      document.getElementById('answer-numerator').value = '';
      document.getElementById('answer-denominator').value = denom;
      
      currentProblem.exchangedLeft1 = false;
      currentProblem.exchangedLeft2 = false;
      currentProblem.exchangedRight1 = false;
      currentProblem.exchangedRight2 = false;
    }

    function toggleShops() {
      shopsVisible = !shopsVisible;
      const shopsContainer = document.getElementById('shops-container');
      const mainContent = document.getElementById('main-content');
      const toggleBtn = document.getElementById('toggle-shop-btn');
      
      if (shopsVisible) {
        shopsContainer.classList.remove('hidden');
        mainContent.classList.remove('hidden');
        toggleBtn.classList.remove('active');
        toggleBtn.textContent = 'ğŸ‘ï¸ ë¶„ìˆ˜ ìƒì  ìˆ¨ê¸°ê¸°';
      } else {
        shopsContainer.classList.add('hidden');
        mainContent.classList.add('hidden');
        toggleBtn.classList.add('active');
        toggleBtn.textContent = 'ğŸ‘ï¸ ë¶„ìˆ˜ ìƒì  ë³´ì´ê¸°';
      }
    }

    function handleExchange(side, shopType) {
      const { leftWhole, leftNum, denom, rightWhole, rightNum } = currentProblem;
      let whole, num, improperNumerator;
      
      if (side === 'left') {
        whole = leftWhole;
        num = leftNum;
        if (shopType === 1) {
          currentProblem.exchangedLeft1 = true;
        } else {
          currentProblem.exchangedLeft2 = true;
        }
      } else {
        whole = rightWhole;
        num = rightNum;
        if (shopType === 1) {
          currentProblem.exchangedRight1 = true;
        } else {
          currentProblem.exchangedRight2 = true;
        }
      }
      
      let newWhole, newNum;
      if (shopType === 1) {
        newWhole = whole - 1;
        newNum = denom + num;
      } else {
        newWhole = 0;
        newNum = whole * denom + num;
      }
      
      improperNumerator = whole * denom + num;
      
      const color = side === 'left' ? '#ed8936' : '#9333ea';
      const borderColor = side === 'left' ? '#c05621' : '#6b21a8';
      
      const resultDiv = document.getElementById(`exchange-result-${shopType}`);
      const textDiv = document.getElementById(`exchange-text-${shopType}`);
      const stepsDiv = document.getElementById(`exchange-steps-${shopType}`);
      
      if (shopType === 1) {
        if (newWhole === 0) {
          textDiv.innerHTML = `<span class="mixed-number">${whole}<span class="fraction"><span class="fraction-numerator">${num}</span><span class="fraction-denominator">${denom}</span></span></span> â†’ <span class="fraction"><span class="fraction-numerator">${newNum}</span><span class="fraction-denominator">${denom}</span></span>`;
          stepsDiv.innerHTML = `ìì—°ìˆ˜ 1ì„ <span class="fraction"><span class="fraction-numerator">${denom}</span><span class="fraction-denominator">${denom}</span></span>ë¡œ ë°”ê¾¸ê³  ë”í–ˆì–´ìš”`;
        } else {
          textDiv.innerHTML = `<span class="mixed-number">${whole}<span class="fraction"><span class="fraction-numerator">${num}</span><span class="fraction-denominator">${denom}</span></span></span> â†’ <span class="mixed-number">${newWhole}<span class="fraction"><span class="fraction-numerator">${newNum}</span><span class="fraction-denominator">${denom}</span></span></span>`;
          stepsDiv.innerHTML = `ìì—°ìˆ˜ ë¶€ë¶„ ì¤‘ 1ì„ <span class="fraction"><span class="fraction-numerator">${denom}</span><span class="fraction-denominator">${denom}</span></span>ë¡œ ë°”ê¾¸ê³  ë”í–ˆì–´ìš”`;
        }
      } else {
        textDiv.innerHTML = `<span class="mixed-number">${whole}<span class="fraction"><span class="fraction-numerator">${num}</span><span class="fraction-denominator">${denom}</span></span></span> â†’ <span class="fraction"><span class="fraction-numerator">${newNum}</span><span class="fraction-denominator">${denom}</span></span>`;
        stepsDiv.innerHTML = `ëª¨ë“  ìì—°ìˆ˜ë¥¼ ë¶„ìˆ˜ë¡œ: ${whole} Ã— ${denom} + ${num} = ${newNum}`;
      }
      
      resultDiv.style.display = 'block';
      
      updateVisualizationForExchange(side, whole, num, newWhole, newNum, denom, shopType);
      
      document.getElementById(`no-exchange-message-${shopType}`).style.display = 'none';
      document.getElementById(`conversion-display-${shopType}`).style.display = 'block';
    }

    function updateVisualizationForExchange(side, originalWhole, originalNum, newWhole, newNum, denom, shopType) {
      const container = document.getElementById(`initial-bars-${shopType}`);
      container.innerHTML = '';
      
      const color = side === 'left' ? '#ed8936' : '#9333ea';
      const borderColor = side === 'left' ? '#c05621' : '#6b21a8';
      
      const originalLabel = document.createElement('div');
      originalLabel.className = 'vis-label';
      originalLabel.style.fontSize = '14px';
      originalLabel.style.marginTop = '0';
      originalLabel.style.color = color;
      originalLabel.textContent = `ì›ë˜: ${originalWhole} ${originalNum}/${denom}`;
      container.appendChild(originalLabel);
      
      const originalRow = document.createElement('div');
      originalRow.className = 'bar-row';
      
      for (let i = 0; i < originalWhole; i++) {
        const bar = document.createElement('div');
        bar.className = 'bar whole-bar';
        bar.style.background = color;
        bar.style.borderColor = borderColor;
        bar.textContent = '1';
        originalRow.appendChild(bar);
      }
      
      if (originalNum > 0) {
        const fracBar = document.createElement('div');
        fracBar.className = 'bar';
        const fracWidth = 80 * (originalNum / denom);
        fracBar.style.width = `${fracWidth}px`;
        fracBar.style.background = color;
        fracBar.style.borderColor = borderColor;
        fracBar.innerHTML = `<span class="fraction" style="font-size: 12px;"><span class="fraction-numerator" style="border-color: white;">${originalNum}</span><span class="fraction-denominator">${denom}</span></span>`;
        originalRow.appendChild(fracBar);
      }
      
      container.appendChild(originalRow);
      
      if (shopType === 1) {
        const newLabel = document.createElement('div');
        newLabel.className = 'vis-label';
        newLabel.style.fontSize = '14px';
        newLabel.style.marginTop = '16px';
        newLabel.style.color = color;
        if (newWhole === 0) {
          newLabel.textContent = `êµí™˜ í›„: ${newNum}/${denom}`;
        } else {
          newLabel.textContent = `êµí™˜ í›„: ${newWhole} ${newNum}/${denom}`;
        }
        container.appendChild(newLabel);
        
        const newRow = document.createElement('div');
        newRow.className = 'bar-row';
        
        if (newWhole > 0) {
          for (let i = 0; i < newWhole; i++) {
            const bar = document.createElement('div');
            bar.className = 'bar whole-bar';
            bar.style.background = color;
            bar.style.borderColor = borderColor;
            bar.textContent = '1';
            newRow.appendChild(bar);
          }
        }
        
        if (newNum > 0) {
          const fracBar = document.createElement('div');
          fracBar.className = 'bar';
          const fracWidth = newWhole > 0 ? 80 * (newNum / denom) : 80;
          fracBar.style.width = `${fracWidth}px`;
          fracBar.style.background = color;
          fracBar.style.borderColor = borderColor;
          fracBar.innerHTML = `<span class="fraction" style="font-size: 12px;"><span class="fraction-numerator" style="border-color: white;">${newNum}</span><span class="fraction-denominator">${denom}</span></span>`;
          newRow.appendChild(fracBar);
        }
        
        container.appendChild(newRow);
      }
      
      if (shopType === 2) {
        updateImproperBarsVisualization(newWhole, newNum, denom, color, borderColor, shopType);
      }
      
      const conversionText = document.getElementById(`conversion-text-${shopType}`);
      const totalNum = originalWhole * denom + originalNum;
      if (shopType === 1) {
        if (newWhole === 0) {
          conversionText.innerHTML = `<span class="fraction"><span class="fraction-numerator">${newNum}</span><span class="fraction-denominator">${denom}</span></span>`;
        } else {
          conversionText.innerHTML = `<span class="mixed-number">${newWhole}<span class="fraction"><span class="fraction-numerator">${newNum}</span><span class="fraction-denominator">${denom}</span></span></span>`;
        }
      } else {
        conversionText.innerHTML = `<span class="fraction"><span class="fraction-numerator">1</span><span class="fraction-denominator">${denom}</span></span>ì´ ${totalNum}ê°œ`;
      }
      
      const conversionSteps = document.getElementById(`conversion-steps-${shopType}`);
      if (shopType === 1) {
        conversionSteps.innerHTML = `ìì—°ìˆ˜ ë¶€ë¶„ ì¤‘ 1ì„ <span class="fraction"><span class="fraction-numerator">${denom}</span><span class="fraction-denominator">${denom}</span></span>ë¡œ ë°”ê¿”ì„œ ë”í–ˆì–´ìš”`;
      } else {
        conversionSteps.innerHTML = '';
      }
    }
    
    function updateImproperBarsVisualization(whole, num, denom, color, borderColor, shopType) {
      const improperBarsContainer = document.getElementById(`improper-bars-${shopType}`);
      improperBarsContainer.innerHTML = '';
      
      const totalPieces = whole * denom + num;
      const fullRows = Math.floor(totalPieces / denom);
      const remainder = totalPieces % denom;
      
      for (let i = 0; i < fullRows; i++) {
        const row = document.createElement('div');
        row.className = 'bar-row';
        
        for (let j = 0; j < denom; j++) {
          const piece = document.createElement('div');
          piece.className = 'bar fraction-bar';
          piece.style.width = `${80 / denom}px`;
          piece.style.background = color;
          piece.style.borderColor = borderColor;
          piece.innerHTML = `<span class="fraction" style="font-size: 12px;"><span class="fraction-numerator" style="border-color: white;">1</span><span class="fraction-denominator">${denom}</span></span>`;
          row.appendChild(piece);
        }
        
        improperBarsContainer.appendChild(row);
      }
      
      if (remainder > 0) {
        const row = document.createElement('div');
        row.className = 'bar-row';
        
        for (let j = 0; j < remainder; j++) {
          const piece = document.createElement('div');
          piece.className = 'bar fraction-bar';
          piece.style.width = `${80 / denom}px`;
          piece.style.background = color;
          piece.style.borderColor = borderColor;
          piece.innerHTML = `<span class="fraction" style="font-size: 12px;"><span class="fraction-numerator" style="border-color: white;">1</span><span class="fraction-denominator">${denom}</span></span>`;
          row.appendChild(piece);
        }
        
        improperBarsContainer.appendChild(row);
      }
    }

    function checkAnswer() {
      const inputWholeValue = document.getElementById('answer-whole').value;
      const inputNumValue = document.getElementById('answer-numerator').value;
      const inputDenomValue = document.getElementById('answer-denominator').value;
      
      const inputWhole = inputWholeValue === '' ? 0 : parseInt(inputWholeValue);
      const inputNum = parseInt(inputNumValue);
      const inputDenom = parseInt(inputDenomValue);
      
      const { answerWhole, answerNum, denom } = currentProblem;
      const feedback = document.getElementById('feedback');
      
      if (isNaN(inputNum) || isNaN(inputDenom)) {
        feedback.className = 'feedback incorrect';
        feedback.style.display = 'block';
        feedback.textContent = 'ë¶„ìì™€ ë¶„ëª¨ì— ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        return;
      }
      
      if (inputDenom !== denom) {
        feedback.className = 'feedback incorrect';
        feedback.style.display = 'block';
        feedback.textContent = 'ë¶„ëª¨ëŠ” ë¬¸ì œì— ë‚˜ì˜¨ ë¶„ëª¨ì™€ ê°™ì•„ì•¼ í•´ìš”.';
        return;
      }
      
      if (inputWhole === answerWhole && inputNum === answerNum) {
        feedback.className = 'feedback correct';
        feedback.style.display = 'block';
        feedback.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ëŒ€ë¶„ìˆ˜ë¥¼ ê°€ë¶„ìˆ˜ë¡œ ì˜ ë°”ê¾¸ê³ , ì •í™•í•˜ê²Œ ê³„ì‚°í–ˆì–´ìš”!';
      } else if (inputWhole === answerWhole) {
        feedback.className = 'feedback incorrect';
        feedback.style.display = 'block';
        feedback.textContent = 'ìì—°ìˆ˜ ë¶€ë¶„ì€ ë§ì§€ë§Œ ë¶„ìë¥¼ ë‹¤ì‹œ ê³„ì‚°í•´ ë³¼ê¹Œìš”?';
      } else {
        feedback.className = 'feedback incorrect';
        feedback.style.display = 'block';
        feedback.textContent = 'ëŒ€ë¶„ìˆ˜ë¥¼ ê°€ë¶„ìˆ˜ë¡œ ë°”ê¾¸ëŠ” ê³¼ì •ë¶€í„° ë‹¤ì‹œ í•œ ë²ˆ ì°¨ê·¼íˆ ì‚´í´ë³´ì„¸ìš”.';
      }
    }

    function showSolution() {
      const { leftWhole, leftNum, denom, rightWhole, rightNum, answerWhole, answerNum } = currentProblem;
      const leftImproper = leftWhole * denom + leftNum;
      const rightImproper = rightWhole * denom + rightNum;
      const resultImproper = leftImproper - rightImproper;
      
      const answerDisplay = answerWhole === 0 
        ? `<span class="fraction"><span class="fraction-numerator">${answerNum}</span><span class="fraction-denominator">${denom}</span></span>`
        : `<span class="mixed-number">${answerWhole}<span class="fraction"><span class="fraction-numerator">${answerNum}</span><span class="fraction-denominator">${denom}</span></span></span>`;
      
      const lastStepText = answerWhole === 0
        ? `<div class="solution-step"><span class="fraction"><span class="fraction-numerator">${resultImproper}</span><span class="fraction-denominator">${denom}</span></span> = <span class="fraction"><span class="fraction-numerator">${answerNum}</span><span class="fraction-denominator">${denom}</span></span></div>`
        : `<div class="solution-step"><span class="fraction"><span class="fraction-numerator">${resultImproper}</span><span class="fraction-denominator">${denom}</span></span> = <span class="mixed-number">${answerWhole}<span class="fraction"><span class="fraction-numerator">${answerNum}</span><span class="fraction-denominator">${denom}</span></span></span></div>`;
      
      const steps = document.getElementById('solution-steps');
      steps.innerHTML = `
        <div class="solution-step"><span class="mixed-number">${leftWhole}<span class="fraction"><span class="fraction-numerator">${leftNum}</span><span class="fraction-denominator">${denom}</span></span></span> âˆ’ <span class="mixed-number">${rightWhole}<span class="fraction"><span class="fraction-numerator">${rightNum}</span><span class="fraction-denominator">${denom}</span></span></span></div>
        <div class="solution-step"><span class="mixed-number">${leftWhole}<span class="fraction"><span class="fraction-numerator">${leftNum}</span><span class="fraction-denominator">${denom}</span></span></span> = <span class="fraction"><span class="fraction-numerator">${leftImproper}</span><span class="fraction-denominator">${denom}</span></span>, <span class="mixed-number">${rightWhole}<span class="fraction"><span class="fraction-numerator">${rightNum}</span><span class="fraction-denominator">${denom}</span></span></span> = <span class="fraction"><span class="fraction-numerator">${rightImproper}</span><span class="fraction-denominator">${denom}</span></span></div>
        <div class="solution-step"><span class="fraction"><span class="fraction-numerator">${leftImproper}</span><span class="fraction-denominator">${denom}</span></span> âˆ’ <span class="fraction"><span class="fraction-numerator">${rightImproper}</span><span class="fraction-denominator">${denom}</span></span> = <span class="fraction"><span class="fraction-numerator">${resultImproper}</span><span class="fraction-denominator">${denom}</span></span></div>
        ${lastStepText}
        <div class="solution-step">ë”°ë¼ì„œ ë‹µì€ ${answerDisplay}ì…ë‹ˆë‹¤.</div>
      `;
      
      document.getElementById('solution-box').style.display = 'block';
    }

    const draggableLeft = document.getElementById('draggable-fraction-left');
    const draggableRight = document.getElementById('draggable-fraction-right');
    const dropZone1 = document.getElementById('drop-zone-1');
    const dropZone2 = document.getElementById('drop-zone-2');

    let draggedFraction = null;

    draggableLeft.addEventListener('dragstart', (e) => {
      draggableLeft.classList.add('dragging');
      draggedFraction = 'left';
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', draggableLeft.innerHTML);
    });

    draggableLeft.addEventListener('dragend', () => {
      draggableLeft.classList.remove('dragging');
      draggedFraction = null;
    });

    draggableRight.addEventListener('dragstart', (e) => {
      draggableRight.classList.add('dragging');
      draggedFraction = 'right';
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', draggableRight.innerHTML);
    });

    draggableRight.addEventListener('dragend', () => {
      draggableRight.classList.remove('dragging');
      draggedFraction = null;
    });

    dropZone1.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone1.classList.add('drag-over');
    });

    dropZone1.addEventListener('dragleave', () => {
      dropZone1.classList.remove('drag-over');
    });

    dropZone1.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone1.classList.remove('drag-over');
      
      if (draggedFraction === 'left' && !currentProblem.exchangedLeft1) {
        handleExchange('left', 1);
      } else if (draggedFraction === 'right' && !currentProblem.exchangedRight1) {
        handleExchange('right', 1);
      }
    });

    dropZone2.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone2.classList.add('drag-over');
    });

    dropZone2.addEventListener('dragleave', () => {
      dropZone2.classList.remove('drag-over');
    });

    dropZone2.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone2.classList.remove('drag-over');
      
      if (draggedFraction === 'left' && !currentProblem.exchangedLeft2) {
        handleExchange('left', 2);
      } else if (draggedFraction === 'right' && !currentProblem.exchangedRight2) {
        handleExchange('right', 2);
      }
    });

    document.getElementById('new-problem-btn').addEventListener('click', () => {
      generateProblem();
      updateProblemDisplay();
    });

    document.getElementById('toggle-shop-btn').addEventListener('click', toggleShops);
    document.getElementById('check-answer-btn').addEventListener('click', checkAnswer);
    document.getElementById('show-solution-btn').addEventListener('click', showSolution);

    async function onConfigChange(config) {
      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('description-1').textContent = config.description_1 || defaultConfig.description_1;
      document.getElementById('description-2').textContent = config.description_2 || defaultConfig.description_2;
      document.getElementById('shop1-title').textContent = config.shop1_title || defaultConfig.shop1_title;
      document.getElementById('shop2-title').textContent = config.shop2_title || defaultConfig.shop2_title;
      document.getElementById('new-problem-btn').textContent = config.new_problem_button || defaultConfig.new_problem_button;
      
      const toggleBtn = document.getElementById('toggle-shop-btn');
      const baseText = config.toggle_shop_button || defaultConfig.toggle_shop_button;
      if (shopsVisible) {
        toggleBtn.textContent = baseText;
      } else {
        toggleBtn.textContent = baseText.replace('ìˆ¨ê¸°ê¸°', 'ë³´ì´ê¸°');
      }
      
      document.getElementById('check-answer-btn').textContent = config.check_answer_button || defaultConfig.check_answer_button;
      document.getElementById('show-solution-btn').textContent = config.show_solution_button || defaultConfig.show_solution_button;

      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;

      document.body.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      
      const sections = document.querySelectorAll('.section');
      sections.forEach(section => {
        section.style.background = backgroundColor;
      });

      document.querySelector('.answer-section').style.background = backgroundColor;

      const titles = document.querySelectorAll('.section-title, .answer-prompt');
      titles.forEach(title => {
        title.style.color = textColor;
      });

      document.querySelectorAll('.new-problem-btn').forEach(btn => {
        btn.style.background = primaryColor;
      });

      document.querySelectorAll('.btn-primary').forEach(btn => {
        btn.style.background = accentColor;
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            },
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["description_1", config.description_1 || defaultConfig.description_1],
          ["description_2", config.description_2 || defaultConfig.description_2],
          ["shop1_title", config.shop1_title || defaultConfig.shop1_title],
          ["shop2_title", config.shop2_title || defaultConfig.shop2_title],
          ["new_problem_button", config.new_problem_button || defaultConfig.new_problem_button],
          ["toggle_shop_button", config.toggle_shop_button || defaultConfig.toggle_shop_button],
          ["check_answer_button", config.check_answer_button || defaultConfig.check_answer_button],
          ["show_solution_button", config.show_solution_button || defaultConfig.show_solution_button]
        ])
      });
    }

    generateProblem();
    updateProblemDisplay();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b9acac32182d1e1',t:'MTc2NzY5ODA2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>